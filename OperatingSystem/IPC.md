# IPC

프로세스들은 유저공간에서 OS로부터 할당받은 독립된 공간에서 운행한다.

그렇기 때문에 서로 간에 통신이 어렵다.

이를 해결하기 위해서 커널 영역에서 IPC 기술을 제공하고 있다.

- 프로세스간 통신이 필요할 때 사용
- 동기화가 필요하고 **커널이 제공한다.**

# 종류

## 1. PIPE

![Untitled](https://user-images.githubusercontent.com/71375034/149659565-113a20ad-d117-40dc-9cc3-1d099eeae072.png)

익명의 파이프를 만들어서 부모-자식 간에 단방향 통신을 지원한다.

하나의 파이프로는 한쪽 방향으로만 통신 가능해서 읽기/쓰기를 모두 하기 원한다면 2개의 파이프를 사용해야한다.

기본적으로 read, write시에 block되기 때문에 read가 대기중이라면 끝나기 전에는 write할 수 없다.

### 장단점

- 장점
    - 간단하게 구현 가능
        - 기본적으로 pipe(배열) 명령어로 생성 가능하고 read, write 명령어를 사용한다.
- 단점
    - 양방향 통신으로 활용하려면 파이프를 2개 만들어야하는데 이 과정이 꽤 복잡하다.
        - 양방향 하고 싶으면 굳이 파이프 사용 x
    - buffer가 작기 때문에 overflow될 수 있다.
    - 부모-자식 프로세스 간에만 사용 가능하다.

## 2. Named PIPE

![Untitled 1](https://user-images.githubusercontent.com/71375034/149659579-89430155-6120-4f56-9fbf-8cb7a11b9d81.png)

위의 PIPE와 동일한 내용이지만 차이점은 파이프에 이름을 부여해 사용한다.

**why???**

부모-자식 간에 통신할 때는 서로를 명확히 알고 있으므로 굳이 파이프가 어떤 파이프인지 알 필요가 없다.

하지만 **부모-자식 관계가 아닌 프로세스들 간에 통신할 때** 파이프를 사용한다면 어떤 파이프를 통해서 통신하는지 알아야하기 때문

## 3. Messaging passing ⭐️

커널이 메모리 보호를 위해서 대리 전달해주는 방식

따라서, 안전하고 동기화 문제를 신경쓰지 않아도 된다. → 커널이 알아서 동기화 해줌

그러나 번거롭고 오버헤드가 크다.

ex) 프로세스 A가 커널로 메시지를 보내면 그걸 커널이 프로세스 B에게 보내준다.

### 모델

1. Direct Communication
    - A가 커널에 메시지를 직접 주고 커널이 B에게 메시지를 직접 전달
        ![Untitled 2](https://user-images.githubusercontent.com/71375034/149659584-2e6f2b8b-e3a6-4c11-ac59-c797f5cf704a.png)
        
2. Indirect Communication
    - A가 커널에 있는 메시지 박스에 넣어두면 B는 그 박스에 가서 읽어오는 방식
        ![Untitled 3](https://user-images.githubusercontent.com/71375034/149659597-8c399b8a-3d0c-4829-b009-b1d0317a5cf7.png)


둘의 차이는 커널이 직접 주냐 아니냐

### Message Queue

![Untitled 4](https://user-images.githubusercontent.com/71375034/149659602-bf24d309-76d3-45e8-9cb1-1949cb1bc15d.png)

Message passing은 구현보다는 개념적으로 사용되는 용어이다. 프로세스 간의 통신을 하기 위해 메시지를 어떻게 전송할지에 대한 방법론이고 그 구체적인 방법 중 하나가 Message queue 구현 방법이다.(보통 Messaging Passing이라함은 Message Queue라고 해도 무방)

파이프는 데이터 흐름이라면 Message Queue는 선입선출의 자료구조를 가지고 메모리 공간을 통해 전달한다.

데이터에 번호를 붙힘으로써 다수의 프로세스가 동시에 데이터를 다룰 수 있다.

### 장단점

- 장점
    - 비동기 방식이기 때문에 데이터가 많아도 처리가 가능하다.
    - 다수의 프로세스끼리 메시지를 보내고 꺼낼 수 있다.
        - 즉, 분산처리에 용의
- 단점
    - 메시지가 잘 전달되었는지 알 수 없다.
    - 데이터가 많을 수록 추가 메모리 자원이 필요하다.

## 4. Shared memory ⭐️

![Untitled 5](https://user-images.githubusercontent.com/71375034/149659606-700dce68-9670-499f-904c-f5abd96036bd.png)

두 프로세스간의 공유된 메모리를 생성 후 이용하는 것

프로세스가 공유 메모리 할당을 커널에 요청하면 커널은 할당해주고, 어떤 프로세스건 해당 메모리 영역에 접근 할 수 있다.

단순히 공유 메모리를 point하는 방식으로 프로세스에서 사용되는 메모리가 증가되지는 않는다.

### 장단점

- 장점
    - 따로 통신을 이용해 데이터를 주고 받지 않고 바로 메모리에 접근하기 때문에 모든 IPC 중 가장 빠르다.
- 단점
    - 메시지 전달이 아니기 때문에 데이터를 읽어야하는 시점을 알 수 없다.
    - 공유 자원을 이용하므로 동기화 문제를 해결해야한다.
    - 커널에 종속적이기 때문에 허용하고 있는 공유메모리 사이즈를 확인해야한다.

## 5. Memory Map

![Untitled 6](https://user-images.githubusercontent.com/71375034/149659619-65f638c0-239d-4601-bff8-d4dd142a2516.png)

기존적으로 공유 메모리와 비슷한데 메모리 맵은 파일을 메모리에 매핑시켜서 공유한다는 점이다.

즉, 디스크에 있는 파일과 프로세스의 페이지가 연결된다. → 가상 메모리의 페이징 기법과 비슷

통신 느낌보단 파일 접근을 효율적으로 하기 위한 기법이라고 생각

ex) 파일이 오픈되면 파일의 데이터가 메모리에 올라가게되는데 다른 프로세스에서 똑같은 파일을 열어서 메모리에 같은 걸 또 올리면 낭비가 심해지게 되고 데이터 일관성에도 문제가 생김.

그래서 이런 경우 기존 메모리 공간에 같이 접근해서 데이터를 읽고 쓰는 작업을 하는 듯(이 때, 동기화 문제를 스레드가 알아서 해주는 것 같다..!)

### 장단점

- 장점
    - 대용량 데이터를 공유 할 때 사용한다.(메모리에 전부 올라가지 않아도 되니까)
    - File I/O가 느릴 때 사용하면 좋다.
- 단점
    - 파일의 크기를 변경할 수 없다.(사용하기 전, 후 에만 변경 가능)
    - 얼마나 많은 데이터를 얼마나 오랫동안 메모리에 둘 것인지를 컨트롤할 수 없다.

## 6. Socket

![Untitled 7](https://user-images.githubusercontent.com/71375034/149659623-b35fa0bf-5770-4a1e-9f2d-4696956ca3f7.png)

같은 도메인 내에서도 물론 연결 가능하고, 추가적으로 외부 프로세스와 통신할 때 사용한다.

서버 : bind, listen, accept

클라이언트 : connect

즉, 네트워크를 통해 프로세스 간에 통신을 진행

### 장단점

- 장점
    - 외부 시스템과 통신이 가능하다.
- 단점
    - 네트워크 프로그래밍이 가능해야한다.

# 결론

![Untitled 8](https://user-images.githubusercontent.com/71375034/149659627-a0bf613f-3f1f-469a-bf39-00b54fd41079.png)

결국 IPC란 두 개의 프로세스간 통신을 의미하는데 굳이 하나의 컴퓨터에 있는 두 개의 프로세스만을 의미하는 것이 아니다.

서로 다른 컴퓨터의 프로세스들도 통신하는 것도 IPC = 결국 네트워킹이다.

# 질문 리스트

- IPC 기법에 대해 설명해주세요
    
    프로세스들은 유저공간에서 OS로부터 할당받은 독립된 공간에서 운행하기 때문에 서로 간에 통신이 어렵습니다. 따라서 이를 해결하기 위해서 커널 영역에서 제공하는 IPC 기술을 통해 통신합니다.
    
- IPC 기법의 종류를 아는데로 설명해주세요
    
    대표적으로는 파이프, message queue, share memory가 있을 것 같습니다.
    
    파이프는 익명의 파이프라면 부모-자식 프로세스간에 단방향으로 데이터를 공유하는 방법이고 named 파이프라면 부모-자식 관계가 아닌 프로세스끼리도 파이프를 이용해 통신할 수 있는 방법입니다.
    
    파이프가 데이터 흐름이라면 Message Queue는 선입선출의 자료구조를 가지고 메모리 공간을 통해 단방향 전달 하는 방법으로 비동기 방식을 가지고 있고 여러 프로세스끼리 통신이 가능합니다.
    
    마지막으로 share memory는 커널이 공유 메모리를 할당해주면 모든 프로세스가 해당 공유 메모리에 접근하여 사용하는 방식입니다.
    

# 참고

[https://www.byfuls.com/programming/read?id=63](https://www.byfuls.com/programming/read?id=63)

사진 자료
[https://doitnow-man.tistory.com/110](https://doitnow-man.tistory.com/110)
